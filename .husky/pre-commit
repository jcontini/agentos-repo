# Fast schema validation only (blocks malformed YAML)
# Full integration tests run on pre-push

# Get staged readme.md files
STAGED_READMES=$(git diff --cached --name-only --diff-filter=ACMR | grep -E '^apps/[^/]+/readme\.md$' || true)

if [ -z "$STAGED_READMES" ]; then
  echo "‚úÖ No connector readme.md files staged"
  exit 0
fi

echo "üìã Validating YAML schema..."

# Extract app names
APPS=$(echo "$STAGED_READMES" | sed 's|apps/||' | sed 's|/readme.md||' | tr '\n' ' ')

# Run fast schema validation
node scripts/validate-schema.mjs $APPS

if [ $? -ne 0 ]; then
  echo ""
  echo "‚ùå Fix YAML errors before committing"
  exit 1
fi
