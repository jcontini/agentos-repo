# Todoist → Tasks connector mapping
for: tasks

actions:
  list:
    rest:
      method: GET
      url: https://api.todoist.com/rest/v2/tasks
      query:
        filter: "{{params.filter}}"
        project_id: "{{params.project_id}}"
      response:
        mapping:
          id: "[].id"
          title: "[].content"
          description: "[].description"
          status: "[].is_completed ? 'done' : 'open'"
          priority: "4 - [].priority"  # Todoist 4=urgent → our 0
          due: "[].due.date"
          project:
            id: "[].project_id"
          parent_id: "[].parent_id"
          labels: "[].labels"
          url: "[].url"
          connector: "'todoist'"

  get:
    rest:
      method: GET
      url: "https://api.todoist.com/rest/v2/tasks/{{params.id}}"
      response:
        mapping:
          id: ".id"
          title: ".content"
          description: ".description"
          status: ".is_completed ? 'done' : 'open'"
          priority: "4 - .priority"  # Todoist 4=urgent → our 0
          due: ".due.date"
          project:
            id: ".project_id"
          parent_id: ".parent_id"
          labels: ".labels"
          url: ".url"
          connector: "'todoist'"

  create:
    rest:
      method: POST
      url: https://api.todoist.com/rest/v2/tasks
      body:
        content: "{{params.title}}"
        description: "{{params.description}}"
        due_string: "{{params.due}}"
        priority: "4 - {{params.priority}}"  # Our 0=urgent → Todoist 4
        project_id: "{{params.project_id}}"
        parent_id: "{{params.parent_id}}"
      response:
        mapping:
          id: ".id"
          title: ".content"
          description: ".description"
          status: "'open'"
          priority: "4 - .priority"  # Todoist 4=urgent → our 0
          due: ".due.date"
          project:
            id: ".project_id"
          url: ".url"
          connector: "'todoist'"

  update:
    rest:
      method: POST
      url: "https://api.todoist.com/rest/v2/tasks/{{params.id}}"
      body:
        content: "{{params.title}}"
        description: "{{params.description}}"
        due_string: "{{params.due}}"
        priority: "4 - {{params.priority}}"  # Our 0=urgent → Todoist 4
      response:
        mapping:
          id: ".id"
          title: ".content"
          description: ".description"
          status: ".is_completed ? 'done' : 'open'"
          priority: "4 - .priority"  # Todoist 4=urgent → our 0
          due: ".due.date"
          url: ".url"
          connector: "'todoist'"

  complete:
    rest:
      method: POST
      url: "https://api.todoist.com/rest/v2/tasks/{{params.id}}/close"
      response:
        static:
          id: "{{params.id}}"
          status: "done"
          connector: "todoist"

  reopen:
    rest:
      method: POST
      url: "https://api.todoist.com/rest/v2/tasks/{{params.id}}/reopen"
      response:
        static:
          id: "{{params.id}}"
          status: "open"
          connector: "todoist"

  delete:
    rest:
      method: DELETE
      url: "https://api.todoist.com/rest/v2/tasks/{{params.id}}"
      response:
        static:
          success: true

  projects:
    rest:
      method: GET
      url: https://api.todoist.com/rest/v2/projects
      response:
        mapping:
          id: "[].id"
          name: "[].name"
          connector: "'todoist'"

  labels:
    rest:
      method: GET
      url: https://api.todoist.com/rest/v2/labels
      response:
        mapping:
          id: "[].id"
          name: "[].name"
          color: "[].color"
          connector: "'todoist'"
